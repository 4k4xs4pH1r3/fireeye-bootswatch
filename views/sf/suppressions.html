{% extends "sf/base.html" %}

{% block title %}Escalations - {{ super() }}{% endblock %}

{% block head %}
{{ super() }}

{% include "sf/templates.html" %}

<style>
    /* Override the default dialog position so that it is not in front of the file/info view. */
    .modal, .modal.fade.in {
        top: 20%;
        left: 30%;
    }
</style>

<script type="text/javascript">
    $(document).ready(function () {
        StrikeFinder.SuppressionsAppView = StrikeFinder.View.extend({
            initialize: function () {
                var view = this;

                view.suppressions_table = new StrikeFinder.SuppressionsTableView({
                    el: '#suppressions-table'
                });
                view.listenTo(view.suppressions_table, 'click', view.render_hits);
                view.listenTo(view.suppressions_table, 'delete', view.fetch);
                view.listenTo(view.suppressions_table, 'empty', function () {
                    $('.hits-view').fadeOut().hide();
                    $('.details-view').fadeOut().hide();
                });
            },
            do_render_hits: function (data) {
                var view = this;

                log.debug('Row selected: ' + JSON.stringify(data));

                var suppression_id = data['suppression_id'];

                view.run_once('init_hits', function () {
                    view.hits_table_view = new StrikeFinder.HitsSuppressionTableView({
                        el: '#hits-table'
                    });

                    view.hits_details_view = new StrikeFinder.HitsDetailsView({
                        el: '#hits-details-view',
                        hits_table_view: view.hits_table_view,
                        tag: false,
                        suppress: false,
                        masstag: false
                    });
                });

                view.hits_table_view.fetch(suppression_id);

                $('.hits-view').fadeIn().show();
            },
            render_hits: function (data) {
                var view = this;
                StrikeFinder.run(function () {
                    view.do_render_hits(data);
                });
            },
            fetch: function () {
                var view = this;
                StrikeFinder.run(function () {
                    view.suppressions_table.fetch();
                });
            }
        });

        (function () {
            StrikeFinder.run(function () {
                new StrikeFinder.SuppressionsAppView().fetch();
            });
        })();
    });
</script>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class='row-fluid'>
        <div class='span12'>

        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <div id='suppressions-div'>
                <table id="suppressions-table"
                       class="table table-striped table-bordered table-hover table-condensed">
                </table>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div class="row-fluid hits-view hide">
                <table id="hits-table" class="table table-striped table-bordered table-hover table-condensed">
                </table>
            </div>
        </div>
    </div>

    <div id="hits-details-view"></div>

    <div class="row-fluid">
        <div class="span12">
            <br/>
        </div>
    </div>
</div>
{% endblock %}
